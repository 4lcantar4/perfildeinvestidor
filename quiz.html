<!DOCTYPE html>
<html>
<head>
<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700%7CRoboto:400,700" rel="stylesheet">
<link href='style.css' rel='stylesheet' type='text/css'>
<title data-i18n="title-quiz">Aversão a perda Formulario</title>
<link rel="icon" type="image/png" href="icon.png">
<link rel="shortcut icon" type="image/png" href="icon.png">
<meta charset="utf-8">
</head>
	
<div class="navdiv">
    <ul class="ulnav">
        <li class="rvlogo"><b><a>Aversão a perda</a></b></li></b><br>
        <li class="nav"> <a href="index.html">
        <span data-i18n="index">Pagina Inicial</span></a></li>
        <li class="nav"> <a href="instructions.html">
        <span data-i18n="inst-h2">Instruções</span></a></li>
        <li class="nav"> <a class="activenav">
        <span data-i18n="quiz"> Formulário </span></a></li>
    </ul> 
</div>

<div class="main">
<br>
<h1>Aversão a perda</h1>
<hr>
<p class="question" id="question-text"></p>
<div id="alternativas">
    <button class="button" onclick="next_question( 1.0)" style="background-color: #2196f3;">Strongly Agree</button> <br>
    <button class="button" onclick="next_question( 0.5)" style="background-color: #4caf50;">Agree</button> <br>
    <button class="button" onclick="next_question( 0.0)" style="background-color: #bbbbbb;">Neutral/Unsure</button> <br>
    <button class="button" onclick="next_question(-0.5)" style="background-color: #f44336;">Disagree</button> <br>
    <button class="button" onclick="next_question(-1.0)" style="background-color: #b71c1c;">Strongly Disagree</button> <br>
</div>
    <button data-i18n="quiz-back" class="small_button" onclick="prev_question()" id="back_button">Back</button>
<br>

</div>
<!-- JavaScript for the test itself -->
<script>
    var questions;
    var respostas = {};


    async function pegarQuestions(){
        var questions = fetch('tolerancia_de_risco.tsv')
            .then(response => response.text())
            .then(data => {
            // Processar os dados do TSV
            const linhas = data.split('\n');
            const cabecalho = linhas[0].split('\t');
            const dados = linhas.slice(1).map(linha => linha.split('\t'));

            // Criar o dicionário
            const dicionario = {};
            dados.forEach((linha, indice) => {
            const nome = indice + 1; // Usar o índice como nome do dicionário
            linha.forEach((valor, coluna) => {
                const questao = cabecalho[coluna];
                if (!dicionario[nome]) {
                dicionario[nome] = {};
                }
                dicionario[nome][questao] = valor;
            });
            });

            return(dicionario)
            })
            .catch(error => {
                console.error('Ocorreu um erro:', error);
            });

        return(await questions)
    }

    function encontrarAlternativasPreenchida(objeto) {
        var ultimaAlternativa = null;
        var count = 0;
        var total_count = 0;
        
        for (var chave in objeto) {
            if (chave.startsWith('Alternativa')) {
                total_count++;
            }
        }


        var chaves = Object.keys(objeto).reverse();
        for (var i = 0; i < chaves.length; i++) {
            var chave = chaves[i];
            if (chave.startsWith('Alternativa')) {
                count++;
                if (objeto[chave] !== '' && objeto[chave] !== '\r') {
                    ultimaAlternativa = chave;
                    break;
                }
            }
        }
        var count = total_count - count + 1
        var aswners = {}
        var coletou = 0 
        for (var chave in objeto) {
            if (chave.startsWith('Alternativa')) {
                aswners[chave] = objeto[chave]
                coletou++ 
            }
            if (coletou == count){
                break
            }
        }
        aswners.Count = count

        return aswners
    }

    function plotarRespostas(resps){
        var bloco_resps = document.querySelector('div[id="alternativas"]')
        bloco_resps.innerHTML = ''

        var alternativa
        for (var resp in resps){
            alternativa = document.createElement("button")
            alternativa.className = 'button';
            alternativa.style.backgroundColor = '#4caf50';
            alternativa = alternativa
            alternativa.setAttribute("ID",resp)
            alternativa.textContent = resps[resp]
            alternativa.setAttribute("onclick", `next_question("${resp}")`);
            bloco_resps.appendChild(alternativa)
        }
    }

    function next_question(resps){
            var questionText = document.querySelector('p[class="question"]')
            let question_number = questionText.getAttribute("Number")
            respostas[question_number] = resps
            showQuestion(window.questions, parseInt(question_number) + 1)
        }

    function showQuestion(questions, index){
        var questionText = document.querySelector('p[class="question"]')
        try{
            let questao = questions[index]
            questionText.textContent = questao.Pergunta
            questionText.setAttribute("Number", index)
            let resps = encontrarAlternativasPreenchida(questao)
            delete resps.Count
            plotarRespostas(resps)
        } catch(e) {
            console.log(respostas)
        }

        

    }
    function prev_question(){
        var questionText = document.querySelector('p[class="question"]')
        let question_number = questionText.getAttribute("Number")
        if (parseInt(question_number) - 1 >= 1){
            showQuestion(window.questions, parseInt(question_number) - 1)
        }
        
    }

    async function gestaoQuestions(){
        var questionNumber = 1
        showQuestion(await window.questions, questionNumber)
}

(async function() {
  questions = await pegarQuestions();
  gestaoQuestions();
})();
</script>
</body>
</html>
