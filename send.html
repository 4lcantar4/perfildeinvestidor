<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
    <link rel="stylesheet" href="style-instructions.css" />
    <title>QUIZ-Qual é o seu perfil de investidor?</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
      <div class="container">
        <br><br>
        <h1 class="heading"> Resultados do Quiz</h1>
        <hr>
        <br>
         <div class="start-screen">
         <p class="question" style="display: flex;flex-direction: column" id="mensagem">
            Obrigado por participar!
           <br><br/>
            Aguarde alguns instantes estamos salvando as respostas e calculando seu resultado!
        </p>
    <br><br/>
        <!-- Spinner de carregamento -->
        <div class="loader" id="spinner"></div>
        <br>
       <div>
        <button class="quit" id="restartbutton" style="display: none;">Reenviar</button>
        <a class="btn" href="https://sites.google.com/view/seuperfildeinvestidor/" style="margin-top: 10px; display: none;" id="verPerfisButton">Ver os perfis de aversão à perda</a>
    </div>


    <script type="text/javascript">
        // Evento para o botão de reenvio
        document.getElementById("restartbutton").addEventListener("click", function() {
            document.getElementById("restartbutton").style.display = "none";
            sendInformation();
        });

        // Função para enviar as informações
        function sendInformation() {
            let data = {};
            data.SocioEconomics = JSON.parse(localStorage.SocioEconomics);
            data.RiskAverssion = JSON.parse(localStorage.RiskAverssion);
            data.Quiz = JSON.parse(localStorage.Quiz);

            let jsonData = JSON.stringify(data);
            let encodedData = encodeURIComponent(jsonData);

            let url = `https://script.google.com/macros/s/AKfycby7vlwGMpMw36HLgxlYpsP4C7g0GK5a2rVUHdUeyNDGzlYGSzv6zlXLmx0vVpor3hI3tQ/exec?data=${encodedData}`;

            fetch(url, {
                method: "GET"
            }).then(response => {
                sucessoNoEnvio();
            }).catch(error => {
                falhaNoEnvio();
            });
        }

        // Função para lidar com sucesso no envio
        function sucessoNoEnvio() {
            document.getElementById("spinner").style.display = "none";
            calcularEExibirCoeficiente();
            document.getElementById("verPerfisButton").style.display = "block";
        }

        // Função para lidar com falha no envio
        function falhaNoEnvio() {
            document.getElementById("spinner").style.display = "none";
            document.getElementById("mensagem").textContent = "Ops..algo deu errado, clique no botão abaixo";
            document.getElementById("restartbutton").style.display = "block";
        }

        // Função para calcular e exibir o coeficiente
        function calcularEExibirCoeficiente() {
            if (localStorage.Quiz) {
                const quiz = JSON.parse(localStorage.Quiz);
                const coeficiente = quiz.etapa1 / quiz.etapa3;
                document.querySelector('#mensagem').textContent = "Seu coeficiente de aversão: " + coeficiente.toFixed(2);
            }
        }

        // Inicializa o envio das informações
        sendInformation();
    </script>
</body>
</html>

